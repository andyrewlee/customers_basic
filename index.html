<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Customers | Store</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-route.min.js"></script>
  </head>
  <body data-ng-app="myApp">
    <a href="#/">Customers</a> | <a href="#/orders">Orders</a>
    <div data-ng-view="">
    </div>
    <script>
      var myApp = angular.module('myApp', ['ngRoute']);

      myApp.config(function($routeProvider) {
        $routeProvider
        .when('/', {templateUrl: 'partials/customers.html'})
        .when('/orders', {templateUrl: 'partials/orders.html'})
      });

      myApp.controller('CustomersController', function($scope, customerFactory){
        $scope.errors = "";
        $scope.customers = customerFactory.getCustomers();
        $scope.addCustomer = function(){
                               $scope.errors = customerFactory.addCustomer($scope.newCustomer.name);
                             }
        $scope.removeCustomer = function($index){ customerFactory.removeCustomer($index); };
      });

      myApp.controller('OrdersController', function($scope, customerFactory, productFactory, orderFactory){
        $scope.errors = ""
        $scope.customers = customerFactory.getCustomers();
        $scope.orders = orderFactory.getOrders();
        $scope.products = productFactory.getProducts();
        $scope.addOrder = function() {
                            $scope.errors = orderFactory.addOrder($scope.newOrder);
                         }
      });

      myApp.factory('orderFactory', function(){
        var orders = [];
        var factory = {};

        factory.getOrders = function() {
          return orders;
        }

        factory.addOrder = function(newOrder){
          var current_date = new Date();
          var new_order = {}

          if(newOrder == undefined || newOrder.customerName == '' || newOrder.product == '' || newOrder.quantity == '') {
            return "All fields are required";
          }

          new_order.customerName = newOrder.customer.name;
          new_order.quantity = newOrder.quantity;
          new_order.product = newOrder.product;
          new_order.created_at = new Date();
          orders.push(new_order);
        }
        return factory;
      });
      myApp.factory('productFactory', function(){
        var products = ['Shoe', 'Hat', 'Shirt'];
        var factory = {};
        factory.getProducts = function(){
          return products;
        }
        return factory;
      });

      myApp.factory('customerFactory', function(){
        var customers = [];
        var factory = {};
        factory.getCustomers = function(){
          return customers;
        }
        factory.addCustomer = function(info) {
          var new_user = {};
          var current_date = new Date();
          for(i in customers) {
            if(customers[i]['name'] == info) {
              return "The user already exists";
            }
          }
          new_user.name = info;
          new_user.created_at = current_date;
          console.log(new_user.name);
          if(new_user.name == '') {
            return "Write something";
          }
          customers.push(new_user);
        }
        factory.removeCustomer = function(info) {
          customers.splice(info, 1);
        }
        return factory;
      });
    </script>
  </body>
</html>
